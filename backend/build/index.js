(()=>{"use strict";var e={728:function(e,n,t){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var r=i(t(860)),s=i(t(415)),o=i(t(17)),d=process.env.PORT||25566,a=(0,s.default)((0,r.default)()).app,c={},l=function(){return String(Math.floor(999999*Math.random())).padStart(6,"0")};a.ws("/",(function(e,n){e.on("message",(function(n){var t=JSON.parse(n.toString());if(0===t.type){for(var i=l();c[i];)i=l();e.sessionId=i,e.id="",c[i]={server:e,clientMap:{},connectingClientMap:{}};var r={id:"",type:0,data:{id:i}};return e.send(JSON.stringify(r))}if(1===t.type){var s=c[e.sessionId?e.sessionId:t.data.id];if(!s)return e.close();if(s.server===e){var o=s.connectingClientMap[t.id];return delete s.connectingClientMap[t.id],s.clientMap[t.data.id]=o,o.id=t.data.id,o.conId="",void o.send(JSON.stringify(t))}return e.sessionId=t.data.id,e.conId=String(Math.floor(999999*Math.random())).padStart(6,"0"),s.connectingClientMap[e.conId]=e,t.id=e.conId,void s.server.send(JSON.stringify(t))}var d=c[e.sessionId];if(!d)return e.close();if(d.server===e)d.clientMap[t.id].send(JSON.stringify(t));else{if(!e.id)return e.close();t.id=e.id,d.server.send(JSON.stringify(t))}})),e.on("close",(function(n,t){var i=c[e.sessionId];if(i)if(e!==i.server)e.conId?(i.connectingClientMap[e.conId].close(),delete i.connectingClientMap[e.conId]):(i.clientMap[e.id].close(),delete i.clientMap[e.id]);else{for(var r=0,s=Object.keys(i.connectingClientMap);r<s.length;r++){var o=s[r];i.connectingClientMap[o].close()}for(var d=0,a=Object.keys(i.clientMap);d<a.length;d++)o=a[d],i.clientMap[o].close();delete c[e.sessionId]}}))})),a.use(r.default.static(o.default.join(__dirname,"../../frontend/build"))),a.get("*",(function(e,n){n.sendFile(o.default.join(__dirname,"../../frontend/build/index.html"))})),a.listen(d,(function(){console.log("server started at http://localhost:"+d)}))},860:e=>{e.exports=require("express")},415:e=>{e.exports=require("express-ws")},17:e=>{e.exports=require("path")}},n={};!function t(i){var r=n[i];if(void 0!==r)return r.exports;var s=n[i]={exports:{}};return e[i].call(s.exports,s,s.exports,t),s.exports}(728)})();